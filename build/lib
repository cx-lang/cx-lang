#!/usr/bin/env node
require('./utils/globals');
const CS = require('coffee-script');

const SRC = resolve(SRC_DIR, 'lib');
const options = { bare: true };

walk(SRC, function(path, stats){
  var target = path.replace(SRC, LIB_DIR), data;
  if ( stats.extname === '.coffee' ) {
    options.filename = path;
    data = readFile(path)
    if ( data.charCodeAt(0) === 0xFEFF ) data = data.substring(1);
    writeFile(target.slice(0, -6) + 'js', CS.compile(data, options));
  }
  else if ( stats.extname === '.cx' ) {
    data = `module.exports = ${ JSON.stringify(readFile(path)) };`;
    writeFile(target.slice(0, -2) + 'js', data + EOL);
  }
  else {
    require('fs-extra').copySync(path, target);
  }
});
